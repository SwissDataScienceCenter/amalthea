name: jupyter-server
image: {jupyter_image}
entrypoint: ["tini", "-g", "--"]
command:
  - start-notebook.sh
args:
# TODOs:
# - Move these configurations to a configmap and mount it as jupyter_notebook_config.py and
#   jupyter_server_config.py respectively.
# - Drop support for jupyter notebook.
  - "--ServerApp.ip=0.0.0.0"
  - "--NotebookApp.ip=0.0.0.0"
  - "--ServerApp.port=8888"
  - "--NotebookApp.port=8888"
  - "--ServerApp.token={jupyter_token}"
  - "--NotebookApp.token={jupyter_token}"
  - "--ServerApp.allow_origin=https://{host}"
  - "--NotebookApp.allow_origin=https://{host}"
  - "--ServerApp.base_url={path}"
  - "--NotebookApp.base_url={path}"
  - "--ServerApp.root_dir={jupyter_root_dir}"
  - "--NotebookApp.notebook_dir={jupyter_root_dir}"
  - "--ServerApp.default_url={jupyter_default_url}"
  - "--NotebookApp.default_url={jupyter_default_url}"
workingDir: {jupyter_root_dir}
volumeMounts:
  - name: workspace
    mountPath: {jupyter_root_dir}
    subPath: work
ports:
  - name: notebook-port
    containerPort: 8888
    protocol: TCP
securityContext:
  runAsUser: 1000
  runAsGroup: 100
  fsGroup: 100
  allowPrivilegeEscalation: false
